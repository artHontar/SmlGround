@model SmlGround.Models.ProfileViewModel
@{
    ViewBag.Title = "Profile";
}

@section customcss {
    <link rel="stylesheet" href="~/Content/profile.css" />
}
<div class="container emp-profile">
    <form action="/Social/Profile/Edit" method="get">
        <input type="hidden" value="@Model.Id" name="Id">

        <div class="row">
            <div class="col-md-4">
                <div class="profile-img">
                    @if (Model.Avatar == null)
                    {
                        <img name="avatar" src='~/Image/avatar.png' />
                    }
                    else
                    {
                        @Html.Raw("<img name='avatar' src=\"data:image/png;base64,"
                                  + Convert.ToBase64String(Model.Avatar) + "\" />")
                    }
                    @if (Model.IsCurrentUserProfile)
                    {
                        <div class="file btn btn-lg btn-primary">
                            Change Photo
                            <input id="uploadImage" type="file" name="uploadImage" />
                        </div>
                    }

                </div>
            </div>
            <div class="col-md-6">
                <div class="profile-head">
                    <h5>
                        @Html.DisplayFor(x => x.Name) @Html.DisplayFor(x => x.Surname)
                    </h5>
                    @*<h6>

                    </h6>*@
                    <p>
                        <label for="Birthday">День рождения</label>
                        <span>
                            @Html.DisplayFor(x => x.Birthday)
                        </span>
                    </p>
                </div>
            </div>
            @if (Model.IsCurrentUserProfile)
            {
                <div class="col-md-2">
                    @Html.ActionLink("Изменить", "Edit", new { id = Model.Id }, new { htmlAttributes = new { @class = "profile-edit-btn" } })
                    <input type="submit" class="profile-edit-btn" value="Изменить" />
                </div>
            }
        </div>
        <div class="row">
            <div class="col-md-4">
                <div>
                    <div class="list-group" id="list-tab" role="tablist">
                        <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list" href="#list-home" role="tab" aria-controls="home">About</a>
                        <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">Contact</a>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="row">

                    <div class="col-8">
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">

                                <label for="Password">Город</label>
                                @Html.DisplayFor(x => x.City)
                                <br />


                                <label for="Password">Место учёбы</label>
                                @Html.DisplayFor(x => x.PlaceOfStudy)
                                <br />

                            </div>
                            <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">

                                <label for="PasswordConfirm">Skype</label>
                                @Html.DisplayFor(x => x.Skype)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<script>

    var input = document.querySelector("input#uploadImage");
    input.addEventListener("change", function () {

        if (input.value != "") {
            //var formData = new FormData();
            var file = document.querySelector("input[type='file']").files[0];
            
            //var reader = new FileReader();
            //var base64Image;
            //reader.readAsDataURL(file);
            //reader.onload = function () {
            //    base64Image = reader.result;
                var formdata = new FormData();
            formdata.append("uploadImage", file);
                formdata.append("id", document.querySelector("input[name='Id']").value);
                $.ajax({
                    url: "/Social/EditAvatar",
                    data:
                        formdata
                    //formData// не работает нихуя
                    ,
                    dataType: "json",
                    contentType: false,
                    processData: false,
                    type: "post",
                    complete: function ParseResponse(data) {
                        var img = document.querySelector("img[name='avatar']");
                        var reader = new FileReader();
                        var base64Image;
                        reader.readAsDataURL(file);
                        reader.onload = function () {
                            base64Image = reader.result;
                            img.setAttribute(
                                'src', base64Image
                            );
                            input.value = "";
                        }
                        //input.value = "";

                        //var img = document.querySelector("img[name='avatar']");
                        //img.src = "data:image/jpeg;base64," + Convert.ToBase64String(Model.Avatar);
                    }

                });
            };
            
        //}
        function getBase64(file) {
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                return reader.result;
            };
            //reader.onerror = function (error) {
            //    console.log('Error: ', error);
            //};
        }
    },true);
</script>
